<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.careLink.doctor.mapper.DoctorMapper">

    <!--    댓글이 안달린 상담 개수 가져오기-->
    <select id="count" resultType="int">
        SELECT COUNT(*)
        FROM COUNSELING C
                 LEFT JOIN COUNSELING_REPLY CR
                           ON C.COUNSELING_ID = CR.COUNSELING_ID
        WHERE CR.REPLY_ID IS NULL
    </select>

    <!--  로그인한 의사의 진료 과목 번호 가져오기-->
    <select id="getDepartmentId" resultType="int" parameterType="String">
        SELECT DEPARTMENT_ID
        FROM DOCTOR_INFO
        WHERE MEMBER_ID = #{memberId}
    </select>

    <!--의사의 진료 과목에 맞는 상담목록 가져오기-->
    <select id="doctorSelectDCounselingByPage" resultType="CounselingEntity">
        <![CDATA[
        SELECT C.COUNSELING_ID,
               C.COUNSELING_TITLE,
               C.MEMBER_ID,
               C.DEPARTMENT_ID,
               C.COUNSELING_CONTENT,
               C.COUNSELING_DATE,
               C.COUNSELING_IMAGE,
               C.COUNSELING_IMAGE_NAME
        FROM (SELECT ROWNUM AS RNUM,
                     COUNSELING_ID,
                     COUNSELING_TITLE,
                     MEMBER_ID,
                     DEPARTMENT_ID,
                     COUNSELING_CONTENT,
                     COUNSELING_DATE,
                     COUNSELING_IMAGE,
                     COUNSELING_IMAGE_NAME
              FROM (SELECT COUNSELING_ID,
                           COUNSELING_TITLE,
                           MEMBER_ID,
                           DEPARTMENT_ID,
                           COUNSELING_CONTENT,
                           COUNSELING_DATE,
                           COUNSELING_IMAGE,
                           COUNSELING_IMAGE_NAME
                    FROM COUNSELING
                    ORDER BY COUNSELING_ID DESC)
              WHERE ROWNUM <= #{pager.endRowNo}) C
                 LEFT JOIN COUNSELING_REPLY R ON C.COUNSELING_ID = R.COUNSELING_ID
        WHERE R.REPLY_ID IS NULL
          AND C.RNUM >= #{pager.startRowNo}
          AND C.DEPARTMENT_ID = #{doctorDepartmentId}
        ]]>
    </select>

    <!--   자신이 작성한 댓글의 게시물 목록 -->
    <select id="doctorSelectMyCounseling" resultType="DoctorMyCounselingDto">
        <![CDATA[
        SELECT COUNSELING_ID,
               COUNSELING_TITLE,
               COUNSELING_CONTENT,
               COUNSELING_IMAGE,
               COUNSELING_IMAGE_NAME
        FROM (SELECT COUNSELING_ID,
                     COUNSELING_TITLE,
                     COUNSELING_CONTENT,
                     COUNSELING_IMAGE,
                     COUNSELING_IMAGE_NAME
              FROM (SELECT ROWNUM AS RNUM,
                           C.COUNSELING_ID,
                           C.COUNSELING_TITLE,
                           C.COUNSELING_CONTENT,
                           C.COUNSELING_IMAGE,
                           C.COUNSELING_IMAGE_NAME
                    FROM COUNSELING C
                             JOIN COUNSELING_REPLY R
                                  ON C.COUNSELING_ID = R.COUNSELING_ID AND R.MEMBER_ID = #{doctorId}
                    ORDER BY COUNSELING_ID DESC)
              WHERE ROWNUM <= #{pager.endRowNo})
        WHERE ROWNUM >= #{pager.startRowNo}
        ]]>
    </select>
</mapper>

















